<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Instagram 팔로우 비교 - 메인</title>
    <script type="module">
        // Firebase SDK 설정
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.2.0/firebase-app.js";
        import { getFirestore, collection, addDoc, getDocs, updateDoc, deleteDoc, doc } from "https://www.gstatic.com/firebasejs/11.2.0/firebase-firestore.js";

        // Firebase 설정
        const firebaseConfig = {
            apiKey: "AIzaSyCfuRIQ91UNo_A1aHiTvfsZf5t-4hTP5qE",
            authDomain: "grec-3e0e8.firebaseapp.com",
            projectId: "grec-3e0e8",
            storageBucket: "grec-3e0e8.firebasestorage.app",
            messagingSenderId: "376090203842",
            appId: "1:376090203842:web:46c1d5320050bb08394d5b"
        };

        // Firebase 초기화
        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);

        // 계정 추가 함수
        async function addAccount(accountName, followList, grecList) {
            try {
                await addDoc(collection(db, "accounts"), {
                    accountName: accountName,
                    followList: followList,
                    grecList: grecList
                });
                console.log("계정이 성공적으로 추가되었습니다!");
                loadAccounts();  // 계정 추가 후 목록 갱신
            } catch (e) {
                console.error("계정 추가 중 오류 발생: ", e);
            }
        }

        // 계정 수정 함수
        async function updateAccount(accountId) {
            const accountName = document.getElementById('accountName').value;
            const followList = document.getElementById('followList').value.split('\n').map(item => item.trim());
            const grecList = document.getElementById('grecList').value.split('\n').map(item => item.trim());

            try {
                const accountDocRef = doc(db, "accounts", accountId);
                await updateDoc(accountDocRef, {
                    accountName: accountName,
                    followList: followList,
                    grecList: grecList
                });
                console.log("계정이 수정되었습니다!");
                loadAccounts();  // 수정 후 목록 갱신

                // 폼 초기화
                document.querySelector('form button').textContent = '계정 추가';
                document.getElementById('addAccountForm').reset();
            } catch (e) {
                console.error("계정 수정 중 오류 발생: ", e);
            }
        }

        // 계정 삭제 함수
        async function deleteAccount(accountId) {
            try {
                const accountDocRef = doc(db, "accounts", accountId);
                await deleteDoc(accountDocRef);
                console.log("계정이 삭제되었습니다!");
                loadAccounts();  // 삭제 후 목록 갱신
            } catch (e) {
                console.error("계정 삭제 중 오류 발생: ", e);
            }
        }

        // 계정 목록 불러오기
        async function loadAccounts() {
            const accountsSnapshot = await getDocs(collection(db, "accounts"));
            const accountsList = document.getElementById("accountsList");
            accountsList.innerHTML = ''; // 기존 목록 초기화

            accountsSnapshot.forEach((doc) => {
                const accountData = doc.data();
                const accountId = doc.id;

                // 계정 수정 및 삭제 버튼 추가
                const accountElement = document.createElement('div');
                accountElement.classList.add('account-item');
                accountElement.innerHTML = `
                    <p><strong>${accountData.accountName}</strong></p>
                    <p>팔로우 목록: ${accountData.followList.join(', ')}</p>
                    <p>GREC 목록: ${accountData.grecList.join(', ')}</p>
                    <button onclick="editAccount('${accountId}', '${accountData.accountName}', '${accountData.followList.join('\n')}', '${accountData.grecList.join('\n')}')">수정</button>
                    <button onclick="deleteAccount('${accountId}')">삭제</button>
                `;
                accountsList.appendChild(accountElement);
            });
        }

        // 수정 기능
        function editAccount(accountId, accountName, followList, grecList) {
            document.getElementById('accountName').value = accountName;
            document.getElementById('followList').value = followList;
            document.getElementById('grecList').value = grecList;

            // 수정 시 폼 버튼 텍스트 변경
            const submitButton = document.querySelector('form button');
            submitButton.textContent = '수정';
            submitButton.onclick = function() {
                updateAccount(accountId);
            };
        }

        // 계정 추가 폼 처리
        document.addEventListener('DOMContentLoaded', function() {
            loadAccounts();  // 페이지 로드 시 계정 목록 불러오기

            document.getElementById('addAccountForm').addEventListener('submit', function(event) {
                event.preventDefault();

                const accountName = document.getElementById('accountName').value;
                const followList = document.getElementById('followList').value.split('\n').map(item => item.trim());
                const grecList = document.getElementById('grecList').value.split('\n').map(item => item.trim());

                if (accountName && followList.length > 0 && grecList.length > 0) {
                    // 계정 추가 또는 수정
                    if (document.querySelector('form button').textContent === '수정') {
                        // 수정 모드에서 호출
                        updateAccount(document.querySelector('form button').dataset.accountId);
                    } else {
                        // 새 계정 추가
                        addAccount(accountName, followList, grecList);
                    }

                    // 폼 초기화
                    document.getElementById('addAccountForm').reset();
                } else {
                    alert("모든 필드를 채워주세요!");
                }
            });
        });
    </script>
</head>
<body>
    <!-- 네비게이션 바 -->
    <nav>
        <button onclick="location.href='index.html'">메인</button>
        <button onclick="location.href='list.html'">리스트</button>
        <button onclick="location.href='follow.html'">중복(follow)</button>
        <button onclick="location.href='grec.html'">중복(grec)</button>
        <button onclick="location.href='search.html'">검색</button>
        <button onclick="location.href='all.html'">전체</button>
    </nav>

    <h1>Instagram 팔로우 비교 - 메인</h1>

    <!-- 계정 추가 폼 -->
    <form id="addAccountForm">
        <label for="accountName">계정 이름</label>
        <input type="text" id="accountName" placeholder="계정 이름 입력">
        
        <label for="followList">팔로우 목록 (줄바꿈으로 구분)</label>
        <textarea id="followList" rows="6" placeholder="팔로우하는 계정을 줄바꿈으로 입력"></textarea>
        
        <label for="grecList">GREC 목록 (줄바꿈으로 구분)</label>
        <textarea id="grecList" rows="6" placeholder="GREC에 등록된 계정을 줄바꿈으로 입력"></textarea>

        <button type="submit">계정 추가</button>
    </form>

    <h2>계정 관리</h2>
    <div id="accountsList"></div> <!-- 계정 목록을 불러올 영역 -->
</body>
</html>
